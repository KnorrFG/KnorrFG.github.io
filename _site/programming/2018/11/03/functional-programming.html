<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.1.1
    Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    <title>Functionalish Programming</title>
    <meta name="description" content="There already is a myriad of blog posts on functional programming, with this post, I don’t try to give an introduction to it, but I want to highlight, how we...">
    <link rel="canonical" href="http://localhost:4000/programming/2018/11/03/functional-programming.html">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="alternate" type="application/atom+xml" title="Felix&#39; Blog" href="/feed.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>


  <body class="layout--post  functionalish-programming">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/categories/">Categories</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
      <a href="/" class="site-logo" rel="home" title="Felix' Blog">
        <img src="/logo.png" class="site-logo-img animated fadeInDown" alt="Felix' Blog">
      </a>
    
    
      <h1 class="site-title animated fadeIn"><a href="/">Felix' Blog</a></h1>
      <p class="site-description animated fadeIn" itemprop="description">A blog about programming, science, and everything else that I might come up with</p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">Functionalish Programming
</h1>
        
      </header>

      <div class="page-sidebar">
        <div class="page-author h-card p-author"><div class="author-info"><div class="author-name">
        <span class="p-name">Felix G. Knorr</span>
      </div>
    <time class="page-date dt-published" datetime="2018-11-03T00:00:00+01:00"><a class="u-url" href="">November 3, 2018</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy"><a class="p-category" href="/categories/#programming" title="Pages filed under programming">programming</a></li>
  </ul>


        

      </div>

      <div class="page-content">
        <div class="e-content">
          <p>There already is a myriad of blog posts on functional programming, with this
post, I don’t try to give an introduction to it, but I want to highlight, how
we can get inspirations from it, to improve our code. This is why the post is
called “functionalish” programming, instead of “functional” programming.</p>

<p>But before I can talk about what can be learned from it, it is necessary to
talk about what functional programming actually is. Let’s see what Wikipedia
has to say:</p>

<blockquote>
  <p>In computer science, functional programming is a programming paradigm - a style
of building the structure and elements of computer programs - that treats
computation as the evaluation of mathematical functions and avoids
changing-state and mutable data.</p>
</blockquote>

<p>There are already two important principles in there:</p>

<ol>
  <li>Avoid changing state</li>
  <li>Avoid mutable data</li>
</ol>

<p>The first one, avoiding state change, is a no brainer. Most of us learn very
early that it is a bad idea to make a function depend on a global variable.
There are some rare cases where that might be a good idea, but generally it’s
not. If a function is pure, that is its output only depends on its input, and
it does not change any sort of global state, like a display for example, then
it’s easy to test and reliable. Great. But wait, if we aren’t allowed to do any
i/o because that’s state change we cannot write any useful programs. So yeah,
we should try to keep functions pure, but only where applicable.</p>

<p>I want to showcase two bugs that cost me a lot of time:</p>

<ol>
  <li>I used the “choose directory” dialog of a GUI-toolkit which did not only return
the path of the selected folder, but also changed the programs working
directory to the chosen folder. I was absolutely unaware of this second part,
which way later in the program resulted in plugin-loading errors.</li>
  <li>I was using pythons random.shuffle() function. The code looked something
like this: <code class="highlighter-rouge">shuffeled_elems = random.shuffle(elems)</code>. This
function shuffles its argument, it does not return a shuffled version of it.
I was not aware of that, and the fact, that 
<a href="https://stackoverflow.com/questions/976882/shuffling-a-list-of-objects">this</a>
is the first result when googling “python random shuffle” shows that I’m not
the only one. Since in python, a function without return value simply returns
<code class="highlighter-rouge">None</code> there was no easily catchable error.</li>
</ol>

<p>Admittedly, both of those problems could have been prevented by reading the
documentation more carefully, or at all in the second case, but avoiding this
kind of behavior in your own functions will reduce the probability of errors,
which is a good thing.</p>

<p>The second point, “Avoid mutable data”, is more controversial. In C++ it would
translate to: only use <code class="highlighter-rouge">const</code> variables, and in python it would translate to:
don’t change a variable after its creation. 
Of course, I don’t want to tell you to not use lists anymore. Since python
lacks some important concepts that functional languages tend to have, like
e.g. tail recursion, it would really not be wise to ban all mutability from your
code. But still, I’d advice to use <a href="https://docs.python.org/3.7/library/collections.html#collections.namedtuple">namedtuple</a>s or tuples whenever possible.
If I had used a tuple instead of a list, I would have caught that second bug
instantly.</p>

<p>Another important point in functional programming is to use functions as
arguments, and return values. This does not come intuitively, but it can
increase code readability a lot.</p>

<p>An example:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coords_of_interest</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">mat_acc_map</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">iter_3D_vol_coords</span><span class="p">,</span> 
                                             <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">coord</span><span class="p">:</span> <span class="n">mat_acc_map</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> 
                                             <span class="nb">tuple</span><span class="p">)</span>
</code></pre></div></div>

<p>I guess two things need to be explained before this becomes clear:</p>

<ul>
  <li><code class="highlighter-rouge">pipe</code> is a function that takes anything as first argument, and then a bunch
of functions for its varargs. It then feeds the first argument as input to the
first function, the output of the first function as input to the second
function, and so on, and in the end it will return the return value of the last
function. (And in the above example, the input is a numpy array)</li>
  <li><code class="highlighter-rouge">filter</code> is curried, which means that if you call it with an incomplete set
of arguments, it will return a function which only takes the remaining
arguments, and remembers the one, that were already set. So if you have a
curried version of <code class="highlighter-rouge">filter</code> you can define a function that takes an iterable
and only returns those elements that are even with 
<code class="highlighter-rouge">even_only = filter(lambda x: x % 2 == 0)</code></li>
</ul>

<p>(By the way, <code class="highlighter-rouge">pipe</code> and <code class="highlighter-rouge">filter</code> are both defined in the awesome <a href="https://toolz.readthedocs.io/en/latest/index.html">toolz</a> library)</p>

<p>So, provided the knowledge over <code class="highlighter-rouge">pipe</code> and curried functions, the source code
example above becomes quite easy to read: “the coordinates of interest are
those coordinates where the value in the array is not zero”</p>

<p>The Code above also has another advantage which does not immediately become obvious.
<code class="highlighter-rouge">iter_3D_vol_coords</code> and <code class="highlighter-rouge">filter</code> both return generators. Which means every
result is computed lazily, i.e. when it’s queried. So, <code class="highlighter-rouge">tuple</code> looks at the
first element, that <code class="highlighter-rouge">filter</code> returns, then <code class="highlighter-rouge">filter</code> looks at the first element,
that is returned by <code class="highlighter-rouge">iter_3D_vol_coords</code>, if it is suitable it will be
returned, otherwise the next element will be tested. This avoids to first have
a complete list of coordinates, and then filter it. In this example the
difference isn’t too big, but in a lot of scenarios it can reduce the memory
consumption by a lot. If you don’t know generators, I recommend 
<a href="https://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do">this</a>
answer on stackoverflow.</p>

<p>I want to conclude this post with a few rules of thumb, which I try to respect
 as much as possible:</p>

<ul>
  <li>write pure functions whenever possible</li>
  <li>use immutable types whenever possible, especially <a href="https://docs.python.org/3.7/library/collections.html#collections.namedtuple">namedtuple</a> (you can also
derive classes from it)</li>
  <li>use <a href="https://toolz.readthedocs.io/en/latest/index.html">toolz</a>, especially <code class="highlighter-rouge">pipe</code> and <code class="highlighter-rouge">curry</code> (but it also has a lot of other
very convenient functions)</li>
  <li>use generators whenever possible</li>
</ul>

<p>Following these few rules has made my code safer, easier to read, easier to
parallelize, and less RAM intensive.</p>


        </div>

        
          <div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fprogramming%2F2018%2F11%2F03%2Ffunctional-programming.html" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--facebook btn--small"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=Functionalish+Programming%20http%3A%2F%2Flocalhost%3A4000%2Fprogramming%2F2018%2F11%2F03%2Ffunctional-programming.html" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fprogramming%2F2018%2F11%2F03%2Ffunctional-programming.html" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=Functionalish+Programming&url=http%3A%2F%2Flocalhost%3A4000%2Fprogramming%2F2018%2F11%2F03%2Ffunctional-programming.html" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>

        

        
          

        

        <nav class="page-pagination" role="navigation">
  

  
    <a class="page-next" href="/programming/2018/11/12/accessing-pandas-dataframes-with-sql-like-select-statements.html">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Accessing pandas DataFrame using SQL-like select statements
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="/feed.xml"><i class="fas fa-link fa-2x" title="Feed"></i></a></div><div class="copyright">
    
      <p>&copy; 2018 Felix' Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </body>

</html>
